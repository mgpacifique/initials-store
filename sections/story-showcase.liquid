{%- comment -%}
  Story Showcase Section
  Two portrait panels side-by-side (desktop & mobile alike), each with
  a background image, category title, and Shop Men / Shop Women CTAs.
{%- endcomment -%}

{%- if section.settings.section_title != blank or section.settings.section_subtitle != blank -%}
  <div class="story-showcase__header">
    {%- if section.settings.section_title != blank -%}
      <h2 class="story-showcase__section-title">{{ section.settings.section_title }}</h2>
    {%- endif -%}
    {%- if section.settings.section_subtitle != blank -%}
      <p class="story-showcase__section-subtitle">{{ section.settings.section_subtitle }}</p>
    {%- endif -%}
  </div>
{%- endif -%}

<div class="story-showcase">
  <div class="story-showcase__track">
    {%- for block in section.blocks -%}
      {%- liquid
        comment
          Resolve the background image: admin picker wins, then block-level
          asset fallback, then a placeholder SVG.
        endcomment
        assign fallback_asset = ''
        case forloop.index0
          when 0
            assign fallback_asset = 'story-tshirt.jpeg'
          when 1
            assign fallback_asset = 'story-hoodie.jpeg'
        endcase
      -%}
      <div class="story-showcase__panel" {{ block.shopify_attributes }}>
        <div class="story-showcase__image-wrap">
          {%- if block.settings.image != blank -%}
            {{
              block.settings.image
              | image_url: width: 900
              | image_tag:
                loading: 'lazy',
                class: 'story-showcase__image',
                sizes: '(min-width: 750px) 50vw, 44vw',
                widths: '400, 600, 900'
            }}
          {%- elsif fallback_asset != '' -%}
            <img
              src="{{ fallback_asset | asset_url }}"
              alt="{{ block.settings.title | escape }}"
              class="story-showcase__image"
              loading="lazy"
            >
          {%- else -%}
            {{ 'lifestyle-2' | placeholder_svg_tag: 'story-showcase__placeholder' }}
          {%- endif -%}
          <div class="story-showcase__overlay"></div>
        </div>

        <div class="story-showcase__content">
          {%- if block.settings.tag != blank -%}
            <span class="story-showcase__tag">{{ block.settings.tag }}</span>
          {%- endif -%}
          {%- if block.settings.title != blank -%}
            <h3 class="story-showcase__title">{{ block.settings.title }}</h3>
          {%- endif -%}
          <div class="story-showcase__ctas">
            {%- if block.settings.link_men != blank -%}
              <a href="{{ block.settings.link_men }}" class="story-showcase__cta">
                {{- block.settings.label_men | default: 'Shop Men' -}}
              </a>
            {%- endif -%}
            {%- if block.settings.link_women != blank -%}
              <a href="{{ block.settings.link_women }}" class="story-showcase__cta">
                {{- block.settings.label_women | default: 'Shop Women' -}}
              </a>
            {%- endif -%}
          </div>
        </div>
      </div>
    {%- endfor -%}
  </div>
</div>

<style>
  /* ── Section container ── */
  #shopify-section-{{ section.id }} {
    padding: 0;
    width: 100%;
  }

  /* ── Optional header ── */
  .story-showcase__header {
    padding: 3rem 2rem 1.75rem;
    text-align: center;
  }

  .story-showcase__section-title {
    font-size: clamp(1.4rem, 2.5vw, 2.2rem);
    font-weight: 400;
    letter-spacing: -0.01em;
    margin: 0 0 0.4rem;
    color: var(--color-foreground);
  }

  .story-showcase__section-subtitle {
    font-size: 0.95rem;
    color: var(--color-foreground);
    opacity: 0.6;
    margin: 0;
  }

  /* ── Grid track — always side-by-side ── */
  .story-showcase {
    width: 100%;
  }

  .story-showcase__track {
    display: flex;
    flex-direction: row;
    justify-content: center;
    width: 100%;
    box-sizing: border-box;
    gap: {{ section.settings.gap }}px;
    padding: 0 {{ section.settings.outer_padding }}px;
  }

  /* ── Panel — height drives width via aspect-ratio ── */
  .story-showcase__panel {
    flex: 0 0 auto;
    position: relative;
    overflow: hidden;
    aspect-ratio: 3 / 4;
    height: {{ section.settings.max_height }}px;
  }

  /* ── Image ── */
  .story-showcase__image-wrap {
    position: absolute;
    inset: 0;
    overflow: hidden;
  }

  .story-showcase__image,
  .story-showcase__placeholder {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center top;
    display: block;
    transition: transform 0.65s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .story-showcase__panel:hover .story-showcase__image {
    transform: scale(1.04);
  }

  /* ── Gradient overlay ── */
  .story-showcase__overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      transparent 35%,
      rgba(0, 0, 0, 0.55) 100%
    );
  }

  /* ── Content block ── */
  .story-showcase__content {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    padding: 1.25rem 1.1rem 1.5rem;
    z-index: 2;
  }

  .story-showcase__tag {
    font-size: 0.62rem;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 0.3rem;
    font-weight: 500;
  }

  .story-showcase__title {
    font-size: clamp(0.95rem, 1.8vw, 1.35rem);
    font-weight: 400;
    color: #fff;
    margin: 0 0 1rem;
    line-height: 1.2;
    text-shadow: 0 1px 8px rgba(0, 0, 0, 0.3);
  }

  /* ── CTA buttons ── */
  .story-showcase__ctas {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .story-showcase__cta {
    display: inline-flex;
    align-items: center;
    background: rgba(255, 255, 255, 0.92);
    color: #111;
    text-decoration: none;
    font-size: 0.68rem;
    font-weight: 600;
    letter-spacing: 0.09em;
    text-transform: uppercase;
    padding: 0.45rem 0.9rem;
    border-radius: 0;
    white-space: nowrap;
    backdrop-filter: blur(6px);
    transition: background 0.2s ease, color 0.2s ease;
    border: none;
  }

  .story-showcase__cta:hover {
    background: #fff;
    color: #000;
  }

  /* ── Mobile: width-based so both panels always fit the viewport ── */
  @media screen and (max-width: 749px) {
    .story-showcase__track {
      gap: {{ section.settings.mobile_gap }}px;
      padding: 0 {{ section.settings.mobile_outer_padding }}px;
    }

    /* Override the desktop height; let width + aspect-ratio drive the size */
    .story-showcase__panel {
      flex: 1 1 0;
      height: auto;
      min-width: 0;
      aspect-ratio: 3 / 4;
    }

    .story-showcase__title {
      font-size: 0.8rem;
      margin-bottom: 0.6rem;
    }

    .story-showcase__cta {
      font-size: 0.58rem;
      padding: 0.35rem 0.6rem;
      letter-spacing: 0.06em;
    }
  }
</style>

{% schema %}
{
  "name": "Story Showcase",
  "tag": "section",
  "class": "story-showcase-section",
  "max_blocks": 6,
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "label": "Section title",
      "placeholder": "Leave blank to hide"
    },
    {
      "type": "text",
      "id": "section_subtitle",
      "label": "Section subtitle",
      "placeholder": "Optional tagline"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "max_height",
      "label": "Max panel height (desktop)",
      "min": 300,
      "max": 800,
      "step": 10,
      "unit": "px",
      "default": 480
    },
    {
      "type": "range",
      "id": "gap",
      "label": "Gap between panels (desktop)",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 8
    },
    {
      "type": "range",
      "id": "outer_padding",
      "label": "Outer side padding (desktop)",
      "min": 0,
      "max": 80,
      "step": 4,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "mobile_gap",
      "label": "Gap between panels (mobile)",
      "min": 0,
      "max": 24,
      "step": 2,
      "unit": "px",
      "default": 6
    },
    {
      "type": "range",
      "id": "mobile_outer_padding",
      "label": "Outer side padding (mobile)",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 12
    }
  ],
  "blocks": [
    {
      "type": "story",
      "name": "Story panel",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Background image",
          "info": "Overrides the default asset image"
        },
        {
          "type": "text",
          "id": "tag",
          "label": "Tag / eyebrow text",
          "placeholder": "e.g. New Arrivals"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Story title",
          "default": "Story Title"
        },
        {
          "type": "header",
          "content": "Men's CTA"
        },
        {
          "type": "text",
          "id": "label_men",
          "label": "Button label",
          "default": "Shop Men"
        },
        {
          "type": "url",
          "id": "link_men",
          "label": "Collection link"
        },
        {
          "type": "header",
          "content": "Women's CTA"
        },
        {
          "type": "text",
          "id": "label_women",
          "label": "Button label",
          "default": "Shop Women"
        },
        {
          "type": "url",
          "id": "link_women",
          "label": "Collection link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Story Showcase",
      "settings": {
        "max_height": 480,
        "gap": 8,
        "outer_padding": 0,
        "mobile_gap": 6,
        "mobile_outer_padding": 12
      },
      "blocks": [
        {
          "type": "story",
          "settings": {
            "tag": "Essentials",
            "title": "T-Shirts",
            "label_men": "Shop Men",
            "label_women": "Shop Women"
          }
        },
        {
          "type": "story",
          "settings": {
            "tag": "Stay Warm",
            "title": "Hoodies",
            "label_men": "Shop Men",
            "label_women": "Shop Women"
          }
        }
      ]
    }
  ]
}
{% endschema %}
